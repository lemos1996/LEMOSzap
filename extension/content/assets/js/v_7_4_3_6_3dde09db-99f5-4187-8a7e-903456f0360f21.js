import{i as F,b as L,c as I,d as _,e as j,a as w,u as R,L as $}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f20.js";import{i as P,u as D,a as b,S as x,b as W,c as G,d as N,g as O,e as V,f as z,h as B,j as J,k as H,l as K,m as S,n as q,o as Z,p as Q,q as X,r as Y,A as tt,t as et,s as y}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f23.js";import{i as at,a as st}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f24.js";import{i as ot}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f25.js";import{i as it}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f26.js";import{i as nt}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f27.js";import{i as rt}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f28.js";import{P as k}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f11.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f29.js";import{s as ct}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f30.js";import{i as dt}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f31.js";import{i as lt}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f32.js";import{j as u}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f.js";import{a as U}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f7.js";import{W as pt,V as v}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f19.js";import{d as ut,S as h}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f33.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f8.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f4.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f3.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f2.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f10.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f6.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f9.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f34.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f35.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f36.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f37.js";import"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f38.js";const mt=()=>{const t=document.createElement("script");t.src=chrome.runtime.getURL("whatsapp/index.iife.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.remove()}},gt=(t,e,i=5e3)=>{const o=Date.now(),c=()=>{document.querySelector(t)?e():Date.now()-o>=i?(console.error(`Erro: O seletor "${t}" não foi encontrado dentro do tempo limite.`),e()):setTimeout(c,300)};c()};gt("#app .app-wrapper-web",()=>{mt()});F();L();I();(async()=>P())();function ft(t,e){const i=[],o=[],c=new Set(e.flatMap(a=>a.chats.map(n=>`${n.id}|${a.id}`))),s=new Set(t.flatMap(a=>a.chats.map(n=>`${n.id}|${a.id}`))),r=new Map(e.flatMap(a=>a.chats.map(n=>[`${n.id}|${a.id}`,{chat:n,tabId:a.id}]))),d=new Map(t.flatMap(a=>a.chats.map(n=>[`${n.id}|${a.id}`,{chat:n,tabId:a.id}])));for(const a of s)if(!c.has(a)){const n=d.get(a);n&&i.push({...n,chat:{...n.chat,id:k(n.chat.id)}})}for(const a of c)if(!s.has(a)){const n=r.get(a);n&&o.push({...n,chat:{...n.chat,id:k(n.chat.id)}})}return{chatsAdded:i,chatsRemoved:o}}async function E(t,e,i){for(const{chat:o,tabId:c}of t){const s=e.filter(r=>{const d=r.funil.abas.some(g=>g.id===c),a=o.id.endsWith("@g.us"),n=r.regras?.responderGrupos?.propriedades?.active!==!1;return d&&r.acionamento.type===i&&(!a||n)});for(const r of s)try{await x(o.id,r)}catch(d){console.error(`❌ Erro ao disparar follow-up: ${r.id} para chat: ${o.id}`,d)}}}function ht(t,e){t.forEach(({chat:i,tabId:o})=>{e.filter(s=>{const r=s.funil.abas.some(n=>n.id===o),d=i.id.endsWith("@g.us"),a=s.regras?.responderGrupos?.propriedades?.active!==!1;return r&&s.acionamento.type==="timing"&&(!d||a)}).forEach(s=>{b.getState().addChatToFollowUp(s.id,o,i,"tab")})})}function bt(t,e){t.forEach(({chat:i,tabId:o})=>{e.filter(s=>{const r=s.funil.abas.some(n=>n.id===o),d=i.id.endsWith("@g.us"),a=s.regras?.responderGrupos?.propriedades?.active!==!1;return r&&s.acionamento.type==="timing"&&(!d||a)}).forEach(s=>{b.getState().removeChatFromFollowUp(s.id,o,i.id,"tab")})})}function _t(){return D.subscribe(async(e,i)=>{if(!e.userTabs||!b.getState().initSubscribeUserTabs)return;const o=e.userTabs||[],c=i.userTabs||[],s=b.getState().FollowUp.filter(l=>l.active);if(s.length===0)return;const r=c.filter(l=>!o.some(p=>p.id===l.id)),{chatsAdded:d,chatsRemoved:a}=ft(o,c),n=r.flatMap(l=>l.chats.map(p=>({chat:p,tabId:l.id}))),g=a.filter(l=>!n.some(p=>p.chat.id===l.chat.id));if(d.length>0){const l=s.filter(m=>m.acionamento.type==="dispararAoEntrar"),p=s.filter(m=>m.acionamento.type==="timing");l.length>0&&await E(d,l,"dispararAoEntrar"),p.length>0&&ht(d,p)}if(g.length>0){const l=s.filter(f=>f.acionamento.type==="dispararAoSair"),p=g.filter(f=>!r.some(M=>M.id===f.tabId));l.length>0&&p.length>0&&await E(p,l,"dispararAoSair");const m=s.filter(f=>f.acionamento.type==="timing");m.length>0&&bt(g,m)}})}window.addEventListener("message",t=>{if(t.data.type==="Ev"&&t.data.action==="chat.update_label"){const e=JSON.parse(t.data.model);if(!e.chat||!e.chat.id)return;e.chat.id={server:"@"+e.chat.id.split("@")[1],user:e.chat.id.split("@")[0],_serialized:e.chat.id},W.getState().dispartWebhook(e.chat.id.user,"labels",{labels:e.labels,type:e.type})}t.data.type==="Ev"&&t.data.action==="chat.presence_change"&&JSON.parse(t.data.model)});G();N();at();st();O();V();ot();z();it();nt();B();J();H();rt();K();_t();ct({useModal:S,useModalOptions:q});const wt=_.subscribe(t=>({config:t.config}),({config:t})=>{chrome.storage.local.get(["initSystem","userTabs","guardaMsg"],e=>{if(!e.initSystem&&e.userTabs.length===0&&e.guardaMsg.length===0){const{openRendertype:i}=S.getState();t.chromeStoreID!=="ahiieliljkcgmghicbgidblclkbklmka"&&t.chromeStoreID!=="likkccegmkoonimkjnmgpadngedknpdk"&&i("Modelo_Selecao",!1)}})},{fireImmediately:!0});window.addEventListener("beforeunload",()=>{wt()});window.addEventListener("message",async t=>{t.data.type==="Ev"&&t.data.action==="webpack.full_ready"&&(Z(),Q(),await j(),dt(),await X(),Y(),lt())});const St=()=>{const{openModal:t}=S.getState(),{session:e,user:i}=w.getState();if(!e.is_auth)return null;switch(e.user_status){case"test_finished":t({type:"not_structure",modal:u.jsx(h,{status:e.user_status})});break;case"canceled":t({type:"not_structure",modal:u.jsx(h,{status:e.user_status})});break;case"overdue":t({type:"not_structure",modal:u.jsx(h,{status:e.user_status})});break;case"suspended":t({type:"not_structure",modal:u.jsx(h,{status:e.user_status})});break;case"active":const o=ut(i.user_premium.data_liberacao);o<=15&&t({type:"not_structure",modal:u.jsx(h,{status:e.user_status,days:o})});break}},yt=async()=>{await tt(10);const{user:t,session:e,auth_google:i}=w.getState(),{user:o}=await pt.Conn("getMyDeviceId");return{email:t.email,email_auth:i.email_auth,whatsapp_plugin:o,user_premium:!!t.user_premium,user_status:e.user_status,navigator:navigator.userAgent,time:et()}},Tt=async()=>{const{getWebhooks:t}=_.getState(),e=t("login_plugin"),i=new Date().getTime(),o=localStorage.getItem("8fd5ad24df1e1b800d670e563b1b83591980060a=="),c=24;if(o){const s=new Date(o).getTime();if((i-s)/(1e3*60*60)<c)return}if(localStorage.setItem("8fd5ad24df1e1b800d670e563b1b83591980060a==",new Date().toISOString()),e.active){const s=await yt();U.post(e.link,s,{headers:{"Content-Type":"application/json"}})}St()};async function T(){const{language:t}=R.getState(),{config:e}=_.getState(),{login:i,logout:o,session:c,user:s}=w.getState(),{openRendertype:r}=S.getState();if(Tt(),!!c.is_auth)try{const d={email:s.email,access_token_plugin:s.access_token_plugin},a=(await U.post(`${v.backend_plugin}api/auth/validation/${e.chromeStoreID}`,d,{headers:{"Content-Type":"application/json",accept:"application/json","access-token":v.cript_key}})).data;if(a.success)i(a.user,a.auth_google,a.user_status);else if(a.msg_id==="invalid_token_in_validation")r("access_duplicate"),y.error(t[a.msg_id]),o();else if(a.msg_id==="login_other_white_label"){const n=$.getLabel("chromeStoreID",a.origin).config;y.error(u.jsxs(u.Fragment,{children:[t.login_other_white_label,u.jsxs("strong",{children:[n.primeiroNome," "]}),t.login_other_white_label_prt2]})),o()}else y.error(t[a.msg_id]),o()}catch(d){console.error("Error ao tentar validar o login do usuário",d)}}const kt=_.subscribe(t=>({config:t.config}),()=>{T(),kt()},{fireImmediately:!1}),A=async t=>{const{session:e}=w.getState();t.action==="license_update"&&e.user_status!=="free"&&T(),t.action==="license_free_update"&&e.user_status==="free"&&T()};chrome.runtime.onMessage.addListener(A);window.addEventListener("beforeunload",()=>{chrome.runtime.onMessage.removeListener(A)});const vt=new URLSearchParams(window.location.search),C=vt.get("color");if(C){const t=decodeURIComponent(atob(C)),{light:e,dark:i}=JSON.parse(t);if(typeof e=="object"||typeof i=="object"){const o=`
            :root {
                --primaria: ${e.primaria} !important;
                --secundaria: ${e.secundaria} !important;
                --terciaria: ${e.terciaria} !important;
            }

            .dark {
                --primaria: ${i.primaria} !important;
                --secundaria: ${i.secundaria} !important;
                --terciaria: ${i.terciaria} !important;
            }
        `,c="preview-theme",s=document.getElementById(c);s&&s.remove();const r=document.createElement("style");r.id=c,r.textContent=o,document.head.appendChild(r)}}
