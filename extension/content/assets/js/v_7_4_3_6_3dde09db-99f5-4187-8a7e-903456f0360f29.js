import{g as K,d as v,u as d,a as N}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f20.js";import{W as E,ap as O,m as B}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f23.js";import{j as o}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f.js";import{aA as T,t as D,aB as I,as as M,ac as R,ag as L,ae as U,T as _,aC as P,aD as $,af as W,ad as z,aa as F,U as x,I as k,C as j,N as J,W as h,R as q}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f11.js";import{S as V}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f35.js";import{b as Y,a as G}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f36.js";import{C as H}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f37.js";import{b as Q}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f38.js";import{f as X,P as Z}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f9.js";import{W as b}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f19.js";import{c as C}from"./v_7_4_3_6_3dde09db-99f5-4187-8a7e-903456f0360f8.js";const f=[{keys:[{key:"",compress:!1}],tag:"all",nome:"selectAllBackup",checked:!1,merge:!1,icon:o.jsx(T,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"respostasRapidas",compress:!0},{key:"respostasRapidasAcao",compress:!1},{key:"categoria",compress:!0},{key:"guardaMsg",compress:!0},{key:"medias",compress:!1}],tag:"respostasRapidas",nome:"quickReply",checked:!1,merge:!1,icon:o.jsx(D,{className:"w-6 h-6 fill-[var(--primaria)]"})},{keys:[{key:"agendamentos",compress:!1},{key:"agendamentosNaoDisparados",compress:!1},{key:"sendAfterWhatsAppOpens",compress:!0}],tag:"agendamentos",nome:"appointments",checked:!1,merge:!1,icon:o.jsx(I,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"crm",compress:!0}],tag:"crm",nome:"CRM",checked:!1,merge:!1,icon:o.jsx(H,{size:"24px",color:"var(--primaria)"})},{keys:[{key:"contatos",compress:!0}],tag:"contatos",nome:"contacts",checked:!1,merge:!1,icon:o.jsx(Y,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"notes",compress:!0}],tag:"notes",nome:"notes",checked:!1,merge:!1,icon:o.jsx(X,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"notifications",compress:!0}],tag:"notifications",nome:"notifications",checked:!1,merge:!1,icon:o.jsx(V,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"perfil",compress:!0}],tag:"perfil",nome:"profile",checked:!1,merge:!1,icon:o.jsx(E,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"userTabs",compress:!0}],tag:"userTabs",nome:"userTabs",checked:!1,merge:!1,icon:o.jsx(M,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"agrupamentos",compress:!0},{key:"relatorio",compress:!0}],tag:"envioEmMassa",nome:"bulkSending",checked:!1,merge:!1,icon:o.jsx(G,{className:"w-6 h-6 fill-[var(--primaria)]"})},{keys:[{key:"encomendas",compress:!0}],tag:"encomendas",nome:"encomendas",checked:!1,merge:!1,icon:o.jsx(Z,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"autoatendimento",compress:!1}],tag:"autoatendimento",nome:"autoAtendimento",checked:!1,merge:!1,icon:o.jsx(R,{className:"text-[var(--primaria)]",size:24})},{keys:[{key:"replacementStorage",compress:!1}],tag:"replacementStorage",nome:"menuFooter_replace_text",checked:!1,merge:!1,icon:o.jsx(O,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"webhook",compress:!0}],tag:"webhook",nome:"webhook",checked:!1,merge:!1,disabledMerge:!0,icon:o.jsx(L,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"IA",compress:!0}],tag:"IA",nome:"IA",checked:!1,merge:!1,disabledMerge:!0,icon:o.jsx(Q,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"status",compress:!1}],tag:"status",nome:"status",checked:!1,merge:!1,icon:o.jsx(U,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"pinChat",compress:!0}],tag:"pinChat",nome:"fixContacts",checked:!1,merge:!1,icon:o.jsx(_,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"atendimento",compress:!0}],tag:"atendimento",nome:"finalizedOrTrasferAtt",checked:!1,merge:!1,disabledMerge:!0,icon:o.jsx(P,{strokeWidth:.4,className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"backupAutomatico",compress:!0}],tag:"backupAutomatico",nome:"automaticBk",checked:!1,merge:!1,disabledMerge:!0,icon:o.jsx($,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"whatsApi",compress:!0}],tag:"whatsApi",nome:"whatsApi",checked:!1,merge:!1,disabledMerge:!0,icon:o.jsx(W,{strokeWidth:.4,className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"FollowUp",compress:!1}],tag:"FollowUp",nome:"followUp",checked:!1,merge:!1,icon:o.jsx(z,{className:"text-[var(--primaria)]",size:24})},{keys:[{key:"fluxo",compress:!0},{key:"fluxoFiles",compress:!1}],tag:"fluxo",nome:"fluxo",checked:!1,merge:!1,icon:o.jsx(F,{className:"text-[var(--primaria)]",size:24})}],ee=C()((i,y)=>({backup:null,keys:[],getBackup:()=>chrome.storage.local.get(null,async e=>{const{language:s}=d.getState();try{const r=f.filter(a=>{if(a.tag==="all"||a.tag==="IA"&&e.IA&&e.IA.activeIA||a.tag==="atendimento"&&e.atendimento||a.tag==="backupAutomatico"&&e.backupAutomatico&&e.backupAutomatico.date.length>0)return!0;if(a.tag==="replacementStorage"&&e.replacementStorage){const t=e.replacementStorage;if(t.state&&Array.isArray(t.state.items)&&t.state.items.length>0||Array.isArray(t.items)&&t.items.length>0)return!0}return!!(a.tag==="whatsApi"&&e.whatsApi&&e.whatsApi.token.length>0||a.tag==="fluxo"&&e.fluxo&&e.fluxo.workflows.length>0||a.keys.find(t=>e[t.key]&&e[t.key].length>0))});i({keys:r,backup:e})}catch(r){console.error("Erro ao tentar capturar o backup",r),k({type:"Error",message:s.getBkError,position:"top-right"})}}),setActiveKey:(e,s)=>i(r=>({keys:r.keys.map(t=>e==="all"?{...t,checked:s}:t.tag===e?{...t,checked:s}:t.tag==="all"&&!s?{...t,checked:!1}:t)})),setActiveMerge:(e,s)=>i(r=>({keys:r.keys.map(t=>e==="all"?{...t,merge:s}:t.tag===e?{...t,merge:s}:t.tag==="all"&&!s?{...t,merge:!1}:t)})),clearState:()=>i({backup:null,keys:[]}),exportBackup:()=>{const{backup:e,keys:s,downloadBackup:r}=y(),{language:a}=d.getState(),{close:t,openRendertype:n}=B.getState(),{session:l}=N.getState();if(!s.find(c=>c.checked)){k({type:"Error",message:a.selectBkItemExport,position:"top-right"});return}if(!l.is_premium){n("user_free");return}const u={};for(let c of s)if(!(!c.checked||c.tag==="all"))for(let p of c.keys){let m=e[p.key];if(typeof m=="string")try{m=JSON.parse(m)}catch{}m&&typeof m=="object"&&"state"in m&&"version"in m&&(m=m.state),p.compress?u[p.key]=j.encryptData(m):u[p.key]=m}delete u.guardaMsg,delete u.medias,t(),r(u)},downloadBackup:e=>{const{whatsappID:s}=K.getState(),{config:r}=v.getState(),{language:a}=d.getState(),t=JSON.stringify(e),n=new Blob([t],{type:"application/json"}),{day:l,month:u,year:c}=x.dayDate(),{hours:p,minutes:m,seconds:A}=x.timeDate(),S=`backup_${l}-${u}-${c}_${p} ：${m} ：${A}.json`,g=document.createElement("a");g.setAttribute("href",URL.createObjectURL(n)),g.setAttribute("download",S),g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),k({type:"Success",message:a.backup_exportado,position:"top-right"}),(async()=>(await b.Chat("sendTxt",{id:s,msg:`*_${r.primeiroNome}:_*
 ${a.bkMessageSucess}`}),b.Chat("sendDoc",{id:s,base64:n,name:S})))()}})),w=C()((i,y)=>({automaticoBK:{date:"",time:"",recurrency:"",items:[]},createOrEditAttBk:{date:"",time:"",recurrency:"",items:[]},keys:f,startCreateOrEditAtt:()=>i(e=>{const s=f.map(r=>e.automaticoBK.items.length+1===f.reduce((a,t)=>a+t.keys.length,0)?{...r,checked:!0}:r.keys.find(a=>e.automaticoBK.items.includes(a.key))?{...r,checked:!0}:r);return{createOrEditAttBk:e.automaticoBK,keys:s}}),setCreateOrEditAttBk:e=>i(()=>({createOrEditAttBk:e})),setActiveKey:(e,s)=>i(r=>{const a=r.keys.map(n=>e==="all"?{...n,checked:s}:n.tag===e?{...n,checked:s}:n.tag==="all"&&!s?{...n,checked:!1}:n),t=a.reduce((n,l)=>(l.checked&&l.tag!=="all"&&n.push(...l.keys.map(u=>u.key)),n),[]);return{keys:a,createOrEditAttBk:{...r.createOrEditAttBk,items:t}}}),saveAutomaticoBK:()=>{const{createOrEditAttBk:e,keys:s}=y(),{language:r}=d.getState(),{close:a}=B.getState();if(!s.find(t=>t.checked)){k({type:"Error",message:r.bkAttNotItem,position:"top-right"});return}if(e.date.length<=0||e.time.length<=0){k({type:"Error",message:r.bkAttNotDateOrTime,position:"top-right"});return}h("backupAutomatico",e),i({automaticoBK:e,keys:f}),a(),k({type:"Success",message:r.autoBackupCreated,position:"top-right"})},removeAutomaticoBK:()=>i(()=>{const{close:e}=B.getState(),{language:s}=d.getState();return h("backupAutomatico",{date:"",time:"",recurrency:"",items:[]}),e(),k({type:"Success",message:s.autoBackupRemoved,position:"top-right"}),{automaticoBK:{date:"",time:"",recurrency:"",items:[]}}}),validateTimeoutBk:()=>{const{automaticoBK:e,exportBkAtt:s}=y();if(e.date.length<=0)return;if(x.Dois_min_differ(`${e.date} ${e.time}`)){s();let a=e;e.recurrency===""?a={...e,date:"",time:""}:a={...e,date:x.CalcularProximaData(e.date,e.recurrency)},i({automaticoBK:a}),h("backupAutomatico",a)}},exportBkAtt:()=>{const{automaticoBK:e}=y(),{downloadBackup:s}=ee.getState(),{session:r}=N.getState(),{language:a}=d.getState(),{getUrl:t}=v.getState(),n=t("principais","checkout");if(!r.is_premium){J("backupAutomatico",a.btnPremium,n.link);return}chrome.storage.local.get([...e.items],l=>{const u={};for(const c of e.items)if(!(c==="IA"&&(!l.IA||!l.IA.activeIA))&&!(c==="atendimento"&&l.atendimento)&&!(!l[c]||l[c].length===0))for(const p of f){const m=p.keys.find(A=>A.key===c);m&&(m.compress?u[c]=j.encryptData(l[c]):u[c]=l[c])}s(u)})}}));(async()=>{const i=await q("backupAutomatico");i&&i.date.length>0&&w.setState({automaticoBK:i})})();const pe=i=>{w.setState({automaticoBK:i}),h("backupAutomatico",i)};chrome.runtime.onMessage.addListener(async i=>{switch(i.action){case"Update_BackupAutomatico":w.getState().validateTimeoutBk();break}});export{f as B,ee as a,pe as b,w as u};
